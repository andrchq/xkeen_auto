{
  "routing": {
    "domainStrategy": "IPIfNonMatch",
    "rules": [
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "block",
        "network": "udp",
        "port": "135,137,138,139"
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "block",
        "domain": [
          "ext:geosite_v2fly.dat:category-ads-all",
          "google-analytics",
          "analytics.yandex",
          "appcenter.ms",
          "app-measurement.com",
          "firebase.io",
          "crashlytics.com"
        ]
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "block",
        "network": "udp",
        "port": "443",
        "ip": [
          "ext:geoip_zkeenip.dat:!ru"
        ]
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "vless-reality",
        "network": "udp",
        "port": "50000-50030"
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "vless-reality",
        "domain": [
          "ext:geosite_zkeen.dat:domains",
          "ext:geosite_zkeen.dat:other",
          "ext:geosite_zkeen.dat:youtube",
          "domain:google.com",
          "full:gemini.google.com",
          "chatgpt.com",
          "domain:chatgpt.com",
          "full:chatgpt.com",
          "ext:geosite_v2fly.dat:telegram"
        ]
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "vless-reality",
        "ip": [
          "138.128.136.0/21",
          "162.158.0.0/15",
          "172.64.0.0/13",
          "34.0.0.0/15",
          "34.2.0.0/16",
          "34.3.0.0/23",
          "34.3.2.0/24",
          "35.192.0.0/12",
          "35.208.0.0/12",
          "35.224.0.0/12",
          "35.240.0.0/13",
          "5.200.14.128/25",
          "66.22.192.0/18",
          "104.16.0.0/12",
          "13.200.0.0/13",
          "13.208.0.0/12",
          "13.224.0.0/12",
          "13.24.0.0/13",
          "13.32.0.0/12",
          "13.48.0.0/13",
          "13.56.0.0/14",
          "143.204.0.0/16",
          "18.128.0.0/9",
          "18.32.0.0/11",
          "18.64.0.0/10",
          "188.114.96.0/22",
          "204.11.56.0/23",
          "23.227.32.0/19",
          "3.128.0.0/9",
          "ext:geoip_zkeenip.dat:discord",
          "ext:geoip_zkeenip.dat:telegram"
        ]
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "direct",
        "protocol": [
          "bittorrent"
        ]
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "direct",
        "domain": [
          "regexp:^([\\w\\-\\.]+\\.)ru$",
          "regexp:^([\\w\\-\\.]+\\.)su$",
          "regexp:^([\\w\\-\\.]+\\.)xn--p1ai$",
          "regexp:^([\\w\\-\\.]+\\.)xn--p1acf$",
          "regexp:^([\\w\\-\\.]+\\.)xn--80asehdb$",
          "regexp:^([\\w\\-\\.]+\\.)xn--c1avg$",
          "regexp:^([\\w\\-\\.]+\\.)xn--80aswg$",
          "regexp:^([\\w\\-\\.]+\\.)xn--80adxhks$",
          "regexp:^([\\w\\-\\.]+\\.)moscow$",
          "regexp:^([\\w\\-\\.]+\\.)xn--d1acj3b$",
          "ext:geosite_v2fly.dat:category-gov-ru",
          "ext:geosite_v2fly.dat:yandex",
          "ext:geosite_v2fly.dat:vk",
          "ext:geosite_v2fly.dat:steam",
          "ext:geosite_v2fly.dat:whatsapp"
        ]
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "direct",
        "ip": [
          "127.0.0.0/8",
          "10.0.0.0/8",
          "172.16.0.0/12",
          "192.168.0.0/16",
          "169.254.0.0/16",
          "ext:geoip_zkeenip.dat:ru"
        ]
      },
      {
        "type": "field",
        "inboundTag": ["redirect", "tproxy"],
        "outboundTag": "direct",
        "network": "tcp,udp"
      }
    ]
  }
}
